ΛΕΙΤΟΥΡΓΙΚΑ ΣΥΣΤΗΜΑΤΑ 2024 ΕΡΓΑΣΙΑ 1η
Ονοματεπώνυμο:     ΔΑΜΙΑΝΟΣ ΣΚΑΡΤΣΙΛΑΣ 
Αριθμός Μητρώου :  1115201800180 
διεύθυνση e-mail : sdi1800180@di.uoa.gr

Εντολές μεταγλώττισης/εκτέλεσης προγράμματος 
(με μέγιστο πλήθος 10 children processes και config file 10.000 κύκλων ζωής της Parent process): 
    
    make  
    ./program config_10_10000.txt mobydick.txt 10

H παρούσα εφαρμογή υλοποιημένη σε γλώσσα προγραμματισμού C αφορά σε διαδιεργασιακή επικοινωνία (IPC) η οποία επιτυγχάνεται μέσω χρήσης σημαφόρων (semaphores) και τμήματος διαμοιραζόμενης μνήμης (shared memory segment). Είναι λειτουργική και για τα 3 test files.

Περιεχόμενα πηγαίου κώδικα : 
    Header files:
        command.h   process.h     sharedmem.h      text.h
    Implementation files: 
        command.c   process.c     text.c           main.c
    Makefiles :
        make
    Test files : 
     config_10_10000.txt    config_3_100.txt    config_3_1000.txt      mobydick.txt

Επεξήγηση υλοποιήσης λειτουργικότητας: 
    Η υλοποίηση βασίζεται σε χρήση System V library όσο αφορά τους σημαφόρους και τη διαμοιραζόμενη μνήμη. 

    ---main.c 
Η γενικότερη λογική του προγράμματος εφαρμόζεται στο παραπάνω source file. Πιο συγκεκριμένα η P process αφού διαχειριστεί τα ορίσματα που έδωσε ο χρήστης αποθηκεύει το config file σε ένα struct, το οποίο είναι συνδεδεμένη λίστα από "Command" data type. Επίσης αποθηκεύει και το αρχείο κειμένου σε αντίστοιχη συνδεδεμένη λίστα Textline data type.
Στη συνέχεια δημιουργεί ένα array μεγέθους M τύπου struct Processes και αρχικοποιεί το μέλος pid κάθε θέσης σε 0. Αυτό λειτουργεί σα σημαία καθώς αργότερα η πρώτη "αδεια" θέση (δηλαδη pid == 0) που θα βρεθεί, θα πρέπει να γεμίσει με μία νέα διεργασία που έγινε spawn.
 Ύστερα δημιουργεί το τμήμα διαμοιραζόμενης μνήμης τύπου struct SharedMemory και ένα array σημαφόρων μεγέθος M*2. Αυτό καθώς θα χρησιμοποθιηθούν 2 σημαφόροι για κάθε ζωντανή διεργασία-παιδί. 
Επομένως η P process μπαίνει σε μία διαρκής επανάληψη η οποία θα τελειώσει όταν η function processCommand επιστρέψει 0. Αυτό θα συμβεί όταν διαβαστεί το "EXIT" ως command. Ωστόσο πριν η P process τερματίσει , μεταξύ άλλων, θα τερματίσει όσες διεργασίες δεν έχουν ήδη τερματιστεί (επειδή δεν υπήρξε εντολή τερματισμού γι αυτές στο configfile).
 Αν η processCommand δεν επιστρέψει 0 η P process μέσω της function sendTextToChild θα επιλέξει μια τυχαία διεργασία απο αυτές που τρέχουν και θα της στείλει μία τυχαία γραμμή απο το αρχείο κειμένου που έχει αποθηκεύσει στην αρχή. 

---command.c

Στο παραπάνω source file υλοποιούνται οι περισσότερες λειτουργικότητες που εφαρμόζει η  P process.Οι σημαντικότερες λειτουργικότητες υλοποιούνται στις συναρτήσεις processCommand και sendTextToChild. 
        
H processCommand διαχειρίζεται τις εντολές του config file:

- Οταν διαβάσει το γράμμα S ως εντολή, αναζητά την πρώτη διαθέσιμη θέση στο array processes (δηλαδή την πρώτη θέση για την οποία ισχύει ότι pid == 0) . Ο αριθμός αυτής της θέσης θα είναι και το index του πρώτου σημαφόρου από τον πίνακα σημαφόρων, στον οποίο θα κάνει attatched η νέα διεργασία. Ο δεύτερος σημαφόρος που κάνει attached έχει index "index+maxproecesses". Δηλαδή μία διεργασία παιδί θα γίνει attached για παράδειγμα στον 1ο και στον 11ο, ή στον 2ο και στον 12ο σημαφόρο. 
Επομένως  δημιουργεί μία νέα διεργασία μέσω fork() και καλεί τη συνάρτηση childProcess στην οποία μεταξύ άλλων , η νέα διεργασία θα κάνει attatched στους 2 συγκεκριμένους σημαφόρους. 

- Όταν διαβάσει το γράμμα T ως εντολή , αναζητά και εντοπίζει την διεργασία που πρέπει να τερματίσει και κατόπιν γράφει το μήνυμα "kill" στην διαμοιραζόμενη μνήμη. Κατόπιν θα ειδοποιήσει την αντίστοιχη διεργασία παιδί μέσω του πρώτου σημαφόρου στον οποίο διεργασία είναι attatched, ότι έστειλε κάποιο μήνυμα. Αμέσως μετά περιμένει στον δεύτερο σημαμφόρο μέχρι το παιδί να διαβάσει το μήνυμα. Αυτό το μήνυμα (μαζί με τον κύκλο τερματισμού) θα το διαβάσει η αντίστοιχη ζωντανή διεργασία (αφότου ξεμπλοκαριστεί μέσω του πρώτου σημαφόρου) και κατόπιν θα ειδοποιήσει την P process μέσω του δεύτερου σημαφρόρου ότι διάβασε το μήνυμα. (Τότε θα ξαναξεκινήσει η P process). Έπειτα η συγκεκριμένη διεργασία θα τερματίσει μέσω κλήσης της exit. ( Η "απορρόφηση" του τερματισμού μιας διεργασίας παιδί  από την P process , γίνεται μέσω κλήσης της waitpid => Θα παρατηρήσουμε οτι στο ouptut όλες οι διεργασίες τερματίζουν με exit code 0 ).

- Όταν διαβάσει το EXIT ως εντολή, θα επιστρέψει 0 στη main και έτσι θα τερματίσει η P process (μαζί με όσες δεν έχουν τερματίσει ακόμα).

H function SendTextToChild :
 Eπιλέγει τυχαία μια ζωντανή διεργασία παιδί από το Process array μέσω κλήσης rand() η οποία επιλέγει ένα τυχαίο αριθμό. Επίσης επιλέγει τυχαία με τον ίδιο τρόπο μία γραμμή απο το αρχείο κειμένου. Έπειτα με τον ίδιο τρόπο που αναφέρθηκε προηγουμένως, στέλνει στη διαμοιραζόμενη μνήμη αυτή τη γραμμή για να τη διαβάσει η επιλεγμένη ζωντανή διεργασία. Αυτή η επικοινωνία επιτυγχάνεται πάλι μέσω των δύο υπεύθυνων σημαφόρων στους οποίους η διεργασία παιδί είναι attached.  

---process.c

Στο παραπάνω source file αναπτύσσεται η λειτουργικότητα των νέω παιδιών διεργασιών. Αυτό έχει υλοποιηθεί στην συνάρτηση ChildProcess: 
 Πιο συγκεκριμένα αφού η συνάρτηση έχει δεχτεί τους indexes των δύο σημαφόρων που θα γίνει attached, εισέρχεται σε μία διαρκής επανάληψη , όπου παραμένει blocked στον πρώτο σημαφόρο μέχρι η P process να τον αυξήσει και έτσι να γίνει unblocked. Έτσι θα διαβάσει κάποιο μήνυμα που η P process έχει γράψει στην διαμοιραζόμενη μνήμη. Αν αυτό το μήνυμα είναι το "kill" τότε θα διαβάσει επίσης τον κύκλο τερματισμού, και θα εμφανίσει πόσα μηνύματα έλαβε και πόσους κύκλους διήρκησε. Θα ενημερώσει την P process ότι διάβασε το μήνυμα αυξάνοντας τον δέυτερο σημαφόρο και έπειτα θα τερματίσει μέσω κλήσης exit. Τον τερματισμό αυτό θα απορροφήσει η P process όπως αναφέρθηκε παραπάνω μέσω κλήσης waitpid. Αν διαβάσει κάποιο άλλο μήνυμα σημαίνει ότι επιλέχτηκε ως τυχαία διεργασία . Θα εκτυπώσει την γραμμή απο το αρχείο κειμένου και θα ενημερώσει ην P process μέσω του δεύτερου σημαφόρου. Θα γίνει πάλι block και θα περιμένει.

---text.c 

Το παραπάνω source file περιλαμβάνει τα functions που υλοποιούν λειτουργικότητα σχετική με τη διαχείριση του αρχείο κειμένου.
H function readTextFile τύπου TextLine επιστρέψει την κεφαλή της λίστας στην οποία αποθηκεύει το αρχείο κειμένου. Επίσης στην κεφαλή αποθηκεύει και τον αριθμό των γραμμών του κειμένου προκειμένου αυτός έπειτα να περάσει ως όρισμα στη συνάρτηση SendTextToChild.
--sharedmem.h : δομή για την διαμοιραζόμενη μνήμη

